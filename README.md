# Petalinux 2022.2 on Digilent Arty A7 - Microblaze Softcore

This repository provides files to ADD to the *existing* project-spec folder. Do not replace it!

* Use common configuration from youtube and/or blog to create a Petalinux compatible SOC on the Arty A7.
* Use the files in this repository to make boot from QSPI work

Especially tutorials fail regarding booting from QSPI. The reason is the completely wrong u-boot configuration
and missing config options in `petalinux-config`.

First configure your Flash partitions with petalinux-config -> Autogenerated Hardware Config -> Flash config

```
  Primary Flash (axi_quad_spi_0)  --->
  [ ] Advanced Flash Auto Configuration
      *** partition 0 ***
      (spi0-fpga) name
      (0x300000) size
      *** partition 1 ***
      (spi0-boot) name
      (0x100000) size
      *** partition 2 ***
      (spi0-bootenv) name
      (0x20000) size
      *** partition 3 ***
      (spi0-bootscr) name
      (0x1000) size
      *** partition 4 ***
      (spi0-kernel) name
      (0x0) size
      *** partition 5 ***
      ()  name
```                                                           

*NOTE*: spi0-bootenv partition is unused, and could be omitted.

The following issues are fixed by this meta-layer files:

1. U-boot boot script loads to wrong memory addresses and has nonsensical stuff for Arty A7 board
2. U-boot fails to load script from wrong mem addr 
3. Wrong partition config so that config mem cannot be generated
4. Missing device tree entry for ethernet PHY

The new boot script works the following:

1. It looks if there is a boot script loaded by JTAG, if not, it loads one from QSPI
2. It looks if there is a kernel, dtb and rootfs in memory loaded by JTAG, if not it loads the
   FIT image from QSPI
